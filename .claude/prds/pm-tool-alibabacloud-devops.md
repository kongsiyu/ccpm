---
name: pm-tool-alibabacloud-devops
description: 扩展CCPM支持阿里云云效平台，为新项目提供GitHub和云效平台选择灵活性
status: backlog
created: 2025-09-28T06:53:15Z
---

# PRD: CCPM 阿里云 DevOps (Codeup) 平台集成工具

## Executive Summary

扩展现有CCPM系统以支持阿里云云效平台，在保持GitHub原有工作流程完整性的基础上，为新项目提供平台选择灵活性。通过MCP协议无缝集成云效服务，实现配置驱动的平台选择机制。

**价值主张**: 为CCPM用户提供平台选择灵活性，新项目可以根据需求选择GitHub或阿里云云效作为代码托管和项目管理平台，现有GitHub项目保持不变。

## Problem Statement

### 当前挑战
1. **平台选择局限**: CCPM目前仅支持GitHub，新项目无法选择使用阿里云云效平台
2. **企业环境需求**: 企业新项目常需要使用阿里云云效，但无法享受CCPM的高效项目管理流程
3. **平台灵活性不足**: 无法根据项目性质、团队偏好或企业要求灵活选择代码托管平台

### 为什么现在重要
- 企业数字化转型加速，需要支持多云、多平台的开发工具链
- CCPM的spec-driven开发模式被证明有效，但平台限制阻碍了企业采用
- 阿里云云效在中国市场占有重要地位，支持该平台能显著扩大CCPM用户群体

## User Stories

### 主要用户画像
**企业开发团队Leader**: 负责技术选型和工具链整合的技术经理或架构师

### 核心用户故事

#### 故事1: 平台配置和初始化
**作为** 企业开发团队Leader
**我希望** 能够通过简单配置选择使用云效作为代码托管平台
**以便于** 在企业环境中部署CCPM工作流程而无需更改现有代码管理规范

**验收标准:**
- 通过配置文件指定平台类型（github/yunxiao）
- 一次性配置MCP服务器连接信息
- 项目级平台选择，配置一次全项目生效

#### 故事2: 新项目平台选择灵活性
**作为** 熟悉CCPM的开发者
**我希望** 在开始新项目时能够选择使用GitHub或云效作为托管平台
**以便于** 根据项目需求和企业要求灵活选择最合适的平台

**验收标准:**
- 项目初始化时可以选择目标平台（GitHub/云效）
- 所有CCPM命令在两个平台上功能一致
- PRD → Epic → Task → WorkItem/Issue → Code 工作流程完全保持
- 命令语法和参数保持100%兼容

#### 故事3: 代码管理集成
**作为** 开发团队成员
**我希望** CCPM能够自动同步云效代码仓库状态到工作项
**以便于** 保持项目进度透明度并实现完整的可追溯性

**验收标准:**
- 自动同步分支状态到对应Epic工作树
- 合并请求状态反映到Task进度
- 代码变更历史关联到工作项评论

#### 故事4: 项目协作增强（工作项层级管理）
**作为** 项目经理
**我希望** 利用云效的工作项层级和迭代管理功能增强CCPM的项目跟踪能力
**以便于** 获得更细粒度的项目控制和工时管理

**验收标准:**
- CCPM Epic自动创建对应类型的云效父工作项
- Task作为子工作项自动关联到Epic工作项
- Task状态双向同步到云效工作项状态
- 支持工时记录和预估的自动同步

#### 故事5: 初始化和环境配置
**作为** 企业开发团队Leader
**我希望** 通过增强的`/pm:init`命令一键完成云效平台的环境配置
**以便于** 快速部署CCPM到企业云效环境

**验收标准:**
- 自动检测MCP服务器连接状态
- 引导配置云效项目ID和代码仓库关联
- 自动发现和配置可用的工作项类型
- 验证所有必要权限和配置的完整性

## Requirements

### Functional Requirements

#### 核心功能模块

##### 1. 平台抽象层 (Platform Abstraction Layer)
- **Git操作接口统一**: 抽象分支创建、文件操作、合并请求等操作
- **工作项管理接口统一**: 统一GitHub Issues和云效WorkItem的操作接口，处理类型映射
- **项目级别配置**: 支持云效项目管理独立于代码仓库的架构设计
- **配置驱动平台选择**: 通过`.claude/ccpm.config`文件配置当前使用平台

##### 2. MCP集成模块 (MCP Integration Module)
- **MCP服务器连接管理**: 自动检测和连接阿里云DevOps MCP服务器
- **API调用封装**: 将Codeup MCP工具调用封装为标准化接口
- **错误处理和重试**: 网络异常和API限制的智能处理

##### 3. 配置管理系统 (Configuration Management)
- **平台配置**: 支持项目级和全局级平台选择配置
- **认证管理**: 安全存储和管理GitHub Token和云效Access Token
- **项目映射配置**: 维护代码仓库与云效项目的关联关系
- **工作项类型映射**: 自动检测和配置Epic/Task对应的云效工作项类型
- **混合模式支持**: 同一项目不同Epic可以使用不同平台

##### 4. 命令增强系统 (Command Enhancement)
- **平台检测**: 命令执行时自动检测当前应使用的平台
- **智能路由**: 根据配置将命令路由到对应的平台实现
- **兼容性保证**: 确保所有现有命令在两个平台上行为一致

##### 5. 同步和集成 (Synchronization & Integration)
- **保持现有sync命令**: 完全兼容现有`/pm:sync`、`/pm:epic-sync`、`/pm:issue-sync`命令
- **双向同步机制**: Epic/Task状态与云效工作项双向同步，遵循现有同步规范
- **父子关联**: 实现Epic作为父工作项，Task作为子工作项的层级关系
- **frontmatter兼容**: 工作项同步更新现有frontmatter字段（github、updated、status等）
- **评论审计**: 保持现有issue-sync的评论机制用于透明审计追踪
- **工时集成**: 支持云效工时记录与CCPM任务估算的集成

##### 6. 初始化和环境检测 (Initialization & Environment Detection)
- **MCP连接检测**: 检查MCP服务器连接状态和可用工具
- **项目配置验证**: 验证云效项目ID和权限
- **工作项类型发现**: 自动发现项目可用的工作项类型
- **仓库关联验证**: 验证代码仓库与项目管理的关联配置

### Non-Functional Requirements

#### 性能要求
- **响应时间**: MCP API调用响应时间不超过GitHub API的2倍
- **并发处理**: 支持多个并行Agent同时访问Codeup服务
- **缓存机制**: 实现智能缓存减少API调用频率

#### 兼容性要求
- **向后兼容**: 100%保持现有GitHub工作流程不受影响
- **配置兼容**: 现有`.claude/`目录结构和文件格式不变
- **命令兼容**: 所有现有命令保持相同的语法和行为

#### 安全要求
- **Token安全**: 加密存储所有平台访问令牌
- **权限控制**: 遵循最小权限原则，仅申请必要的API权限
- **审计日志**: 记录所有跨平台操作的审计信息

#### 可靠性要求
- **错误恢复**: MCP连接失败时自动重试和降级处理
- **数据一致性**: 确保跨平台状态同步的数据一致性
- **回滚机制**: 支持配置变更的快速回滚

## Success Criteria

### 主要成功指标

#### 技术指标
- **功能覆盖率**: 95%的现有CCPM命令在云效平台正常工作
- **性能基准**: 云效操作响应时间在GitHub的150%以内
- **错误率**: 跨平台操作错误率低于2%

#### 业务指标
- **配置效率**: 新项目选择云效平台的配置时间不超过30分钟
- **学习成本**: 熟悉GitHub版本的用户使用云效版本零额外培训
- **工作流程一致性**: 两个平台的完整workflow步骤100%一致

#### 用户体验指标
- **配置简便性**: 新项目平台选择配置步骤不超过3步
- **命令一致性**: 用户无需记忆平台特定的命令差异
- **错误提示**: 平台相关错误提供清晰的解决方案指导

## Constraints & Assumptions

### 技术约束
- **MCP协议依赖**: 必须依赖alibabacloud-devops-mcp-server的稳定性和功能完整性
- **API限制**: 受阿里云Codeup API调用频率和功能限制
- **Claude Code环境**: 必须在支持MCP的Claude Code环境中运行

### 业务约束
- **企业网络**: 需要考虑企业防火墙和网络策略对MCP连接的影响
- **合规要求**: 必须满足企业对代码管理工具的安全和合规要求
- **授权模式**: 需要适配企业的统一身份认证和授权体系

### 关键假设
- **MCP稳定性**: 假设alibabacloud-devops-mcp-server具备生产环境稳定性
- **功能完整性**: 假设MCP提供的工具集能覆盖GitHub API的主要功能
- **企业采用**: 假设企业用户愿意投入时间进行云效平台配置和学习

## Out of Scope

### 明确不包含的功能
- **跨平台数据迁移工具**: 不提供GitHub项目到云效项目的迁移功能
- **双平台实时同步**: 不支持GitHub和云效之间的双向实时同步
- **现有项目平台切换**: 不支持已有GitHub项目切换到云效平台
- **其他阿里云服务集成**: 仅限云效Codeup，不包含云效Flow、Packages等其他服务
- **自定义MCP服务器**: 不开发自定义的MCP服务器，仅使用官方alibabacloud-devops-mcp-server
- **企业级用户管理**: 不包含复杂的企业用户权限和组织架构管理
- **现有命令语法修改**: 不改变任何现有CCPM命令的语法、参数或行为模式
- **frontmatter结构变更**: 不修改现有的frontmatter字段结构和格式

### 后期考虑的功能
- **多项目仪表板**: 跨平台的项目状态统一视图
- **平台性能对比**: 两个平台的详细性能分析和优化建议
- **企业级安全增强**: 高级的安全策略和审计功能
- **平台切换助手**: 帮助用户评估和规划新项目的平台选择

## Dependencies

### 外部依赖
- **alibabacloud-devops-mcp-server**: MCP服务器的可用性和稳定性
- **阿里云云效服务**: 平台服务的稳定性和API功能完整性
- **Claude Code MCP支持**: Claude Code对MCP协议的完整支持
- **企业网络环境**: 企业防火墙和网络策略允许MCP连接

### 内部依赖
- **CCPM核心架构**: 基于现有CCPM的命令系统和工作流程
- **配置系统**: 现有的`.claude/`配置目录结构
- **代理系统**: 现有的多代理并行执行框架
- **规则系统**: 基于现有的`.claude/rules/`规则继承机制

### 开发依赖
- **MCP集成测试环境**: 需要阿里云云效测试账号和项目
- **双平台测试**: 需要同时维护GitHub和云效的测试项目
- **企业环境模拟**: 模拟企业网络和安全策略的测试环境

## Technical Architecture

### 架构设计原则
1. **最小侵入**: 对现有CCPM代码的修改最小化
2. **配置驱动**: 通过配置而非代码变更实现平台切换
3. **抽象分离**: 平台特定逻辑与业务逻辑完全分离
4. **平台共存**: 支持GitHub项目和云效项目并存，按需选择
5. **命令兼容**: 100%保持现有命令语法和行为不变
6. **数据兼容**: 保持现有frontmatter和文件结构不变

### 关键架构决策说明

#### 1. 命令系统不变原则
**现有命令完全保持**:
- `/pm:sync` - 全量双向同步（适配云效工作项）
- `/pm:epic-sync` - Epic推送到云效（创建父工作项+子工作项）
- `/pm:issue-sync` - 本地更新推送为工作项评论
- 所有其他PM命令保持相同语法和参数

**实现方式**: 在命令内部根据配置路由到对应平台实现

#### 2. frontmatter兼容性
**保持字段不变**:
```yaml
---
name: Task Name
status: open/closed
github: https://yunxiao.alibabacloud.com/workitems/123  # 虽然叫github，但存云效URL
updated: 2025-01-01T00:00:00Z
depends_on: [124, 125]  # 使用云效工作项ID
---
```

**适配策略**: github字段语义扩展为"外部平台URL"，保持字段名不变

#### 3. 同步机制复用
**GitHub同步逻辑** → **云效同步逻辑**:
- `gh issue create` → `create_work_item`
- `gh issue comment` → `create_work_item_comment`
- `gh issue edit` → 更新云效工作项状态
- `gh issue list` → `search_workitems`

**状态映射**: CCPM状态(open/closed) ↔ 云效工作项状态

### 核心组件设计
```
.claude/
├── ccpm.config              # 平台配置文件
├── adapters/                # 平台适配器
│   ├── github-adapter.md    # GitHub平台适配器
│   ├── yunxiao-adapter.md   # 云效平台适配器
│   └── platform-interface.md # 统一平台接口定义
├── scripts/pm/             # 增强的PM脚本
│   └── init-yunxiao.sh     # 云效平台初始化脚本
└── rules/                  # 平台相关规则
    └── platform-config.md  # 平台配置规则
```

### 配置文件示例
```yaml
# .claude/ccpm.config
platform:
  type: "yunxiao"  # github | yunxiao | auto
  yunxiao:
    mcp_server: "yunxiao"
    # 项目管理配置（独立于代码仓库）
    project_id: "your-project-id"
    organization: "your-org"
    # 代码仓库配置
    repository_id: "your-repo-id"
    # 工作项类型映射（自动发现，可手动覆盖）
    workitem_types:
      epic: "epic"              # Epic对应的工作项类型
      task: "story"             # Task对应的工作项类型
      subtask: "sub_task"       # 子任务类型
    # 字段映射（将frontmatter字段映射到云效字段）
    field_mapping:
      github: "custom_field_url"  # frontmatter的github字段对应云效的自定义字段
      status: "state"             # CCPM状态映射到云效状态
  github:
    repository: "owner/repo"

# 注意：每个项目选择一个平台，不支持混合模式
# 现有GitHub项目保持不变，新项目可选择云效
```

## Implementation Phases

### Phase 1: 核心架构和初始化 (1-2 周)
- 平台抽象层设计和实现
- 配置管理系统
- MCP集成基础框架
- **`/pm:init` 云效初始化增强**

### Phase 2: 工作项管理基础 (2-3 周)
- 工作项类型自动发现和映射
- Epic和Task创建、管理功能（父子关联）
- 基础的代码仓库操作
- 命令路由系统

### Phase 3: 高级集成和同步 (2-3 周)
- 状态双向同步机制
- 工作项层级关系管理
- 工时管理功能
- 项目与代码仓库关联

### Phase 4: 优化和企业级增强 (1-2 周)
- 性能优化
- 错误处理增强
- 企业网络环境适配
- 用户体验优化

## Risk Assessment

### 高风险项
- **MCP协议稳定性**: 如果MCP服务器不稳定，整个集成将受到影响
- **API功能限制**: 云效API可能无法完全对标GitHub API功能
- **企业网络限制**: 企业防火墙可能阻断MCP连接

### 中风险项
- **性能差异**: 云效API响应可能显著慢于GitHub
- **功能差异**: 两个平台的功能模型可能存在不兼容

### 缓解策略
- **充分的MCP功能验证**: 开发前全面测试MCP工具集的可用性
- **降级方案设计**: 为MCP连接失败设计本地缓存和离线模式
- **渐进式开发**: 采用MVP方式，优先实现核心功能