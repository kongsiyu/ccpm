---
title: "配置系统和平台检测"
epic: "pm-tool-alibabacloud-devops"
task_number: "001"
status: "pending"
priority: "high"
parallel: true
depends_on: []
estimated_hours: 8
actual_hours: 0
created: "2025-09-28T07:59:05Z"
updated: "2025-09-28T07:59:05Z"
assignee: ""
tags: ["configuration", "platform-detection", "foundation"]
---

# 配置系统和平台检测

## 概述
建立阿里云云效项目管理工具的配置系统和平台检测机制，采用前置检查+规则模式，最小化对现有文件的修改，为后续平台适配奠定基础。

## 技术要求

### 配置文件创建
- 创建`.claude/ccpm.config`配置文件规范（简化版本）
- 在`.claude/rules/platform-config.md`和相关平台规则文件中定义配置逻辑
- 提供配置文件模板和示例，专注于平台选择

### 前置检查机制和命令路由
- 在sync相关command文档开头增加平台检测指令
- Agent通过读取配置自动选择平台规则
- 云效逻辑通过独立规则文件实现，避免修改GitHub逻辑
- 实现智能命令路由，根据配置选择GitHub或云效平台执行

### 简化配置文件结构
```yaml
# .claude/ccpm.config
platform:
  type: "yunxiao"  # 或 "github"
  project_id: "your-project-id"  # 仅yunxiao需要
```

## 验收标准

### 功能性要求
- [ ] 创建`.claude/ccpm.config`简化配置文件规范
- [ ] 创建`.claude/rules/platform-config.md`平台配置规则
- [ ] 修改sync相关command文档，在开头增加平台检测指令
- [ ] 实现智能命令路由逻辑（GitHub/云效平台选择）
- [ ] `/pm:init`命令增加平台选择引导流程

### 技术要求
- [ ] 前置检查逻辑：在command开头添加平台配置读取
- [ ] Agent通过Bash工具读取YAML配置（yq或类似工具）
- [ ] 创建云效专用规则文件，保持GitHub逻辑完全不变
- [ ] 最小化文件修改，仅在必要的command开头增加检测逻辑

### 性能要求
- [ ] 配置加载时间 < 100ms
- [ ] 平台检测时间 < 500ms
- [ ] 内存占用 < 50MB

## 技术实现细节

### 文件结构
1. **`.claude/ccpm.config`**: 简化项目配置文件
2. **`.claude/rules/platform-config.md`**: 平台配置规则文档
3. **`.claude/rules/platform-yunxiao-*.md`**: 云效平台专用规则文件
4. **修改的command文件**: 仅在开头增加前置检查逻辑

### 前置检查指令模式
在sync相关command文档开头增加：
```markdown
## Platform Detection Instructions

### Step 1: Read Platform Configuration
```bash
if [ -f ".claude/ccpm.config" ]; then
  platform=$(yq eval '.platform.type' .claude/ccpm.config 2>/dev/null || echo "github")
  project_id=$(yq eval '.platform.project_id' .claude/ccpm.config 2>/dev/null || echo "")
else
  platform="github"  # 默认GitHub平台，保持向后兼容
fi
```

### Step 2: Load Platform-specific Rules
Based on platform configuration, read additional rules:
- If platform is "yunxiao": Include rules from `.claude/rules/platform-yunxiao-sync.md`
- If platform is "github": Continue with existing GitHub logic below

### Step 3: Execute Platform-specific Logic
Continue with the original command logic...
```

### 规则文件分离策略
- 原有GitHub逻辑保持不变
- 云效逻辑完全独立在`.claude/rules/platform-yunxiao-*.md`文件中
- Agent根据前置检查结果选择执行对应的平台规则

## 依赖关系
- 无前置依赖，为基础设施任务

## 交付物
- [ ] `.claude/ccpm.config`简化配置文件规范和示例
- [ ] `.claude/rules/platform-config.md`平台配置规则文档
- [ ] `.claude/rules/platform-yunxiao-sync.md`云效同步规则文件
- [ ] 修改后的sync相关command文档（开头增加前置检查指令）
- [ ] `/pm:init`命令增强（增加平台选择引导）
- [ ] 前置检查模式使用文档和示例