---
title: "平台适配器框架"
epic: "pm-tool-alibabacloud-devops"
task_number: "002"
status: "pending"
priority: "high"
parallel: false
depends_on: ["001"]
estimated_hours: 12
actual_hours: 0
created: "2025-09-28T07:59:05Z"
updated: "2025-09-28T07:59:05Z"
assignee: ""
tags: ["adapter", "framework", "alibabacloud", "devops"]
---

# 平台适配器框架

## 概述
基于任务001的配置系统，通过规则文件和命令前置检查实现云效平台适配框架，避免直接开发适配器代码，而是通过MCP工具调用和规则配置实现平台抽象。

## 技术要求

### 规则驱动适配设计
- 通过`.claude/rules/platform-yunxiao-*.md`规则文件实现平台适配
- 基于MCP工具而非直接API调用
- 利用Agent智能路由而非代码适配器
- 保持命令层面的统一接口

### 核心规则模块
1. **项目管理规则**
   - 项目配置读取和验证规则
   - 项目上下文获取指令
   - 权限检查和错误处理规则

2. **工作项操作规则**
   - Epic/Issue到云效WorkItem的映射规则
   - 工作项CRUD操作的MCP工具调用指令
   - 状态流转和关联关系处理规则

3. **数据转换规则**
   - GitHub Issue格式与云效WorkItem格式转换
   - frontmatter字段映射规则
   - 错误处理和重试逻辑规则

### MCP工具调用规范
基于MCP协议，通过规则文件指导Agent调用云效工具：
```markdown
## Yunxiao Platform Operations

### Project Context Setup
Use MCP tools to get project context:
- Call `alibabacloud_devops_get_project_info` with project_id from config
- Validate user permissions and project access
- Set project context for subsequent operations

### Work Item Operations
Map CCPM operations to MCP tool calls:
- `create_work_item` → Epic/Issue创建
- `search_workitems` → 列表查询和过滤
- `update_work_item` → 状态更新和内容修改
- `create_work_item_comment` → 评论添加

### Error Handling Rules
- Network timeouts: retry with exponential backoff
- Authentication errors: guide user to check MCP configuration
- Permission errors: provide clear error messages with solutions
```

## 验收标准

### 功能性要求
- [ ] 创建`.claude/rules/platform-yunxiao-epic-sync.md`规则文件
- [ ] 创建`.claude/rules/platform-yunxiao-issue-sync.md`规则文件
- [ ] MCP工具调用指令完整覆盖CCPM操作
- [ ] 错误处理规则清晰明确
- [ ] 数据转换规则准确映射GitHub Issue格式

### 技术要求
- [ ] 规则文件遵循CCPM既有格式
- [ ] MCP工具调用指令详细准确
- [ ] 支持所有Epic/Issue操作场景
- [ ] 提供清晰的错误处理指导

### 性能要求
- [ ] 规则加载时间 < 100ms
- [ ] MCP工具调用响应合理
- [ ] 错误恢复机制完善

## 技术实现细节

### 规则文件结构设计
```markdown
# .claude/rules/platform-yunxiao-epic-sync.md

## Epic Operations for Yunxiao Platform

### Create Epic
When creating epic on Yunxiao platform:
1. Read epic data from local file
2. Transform to Yunxiao work item format:
   - type: "需求" (requirement type)
   - subject: epic title
   - description: epic description
   - priority: map from CCPM priority
3. Call MCP tool: `create_work_item`
4. Update local epic frontmatter with Yunxiao ID and URL

### Sync Epic Status
When syncing epic status:
1. Get local epic status
2. Map to Yunxiao status values
3. Call MCP tool: `update_work_item`
4. Handle errors and provide user guidance
```

### MCP工具封装规则
- 统一的错误处理模式
- 数据格式转换规则
- 重试和恢复机制
- 用户反馈和日志记录

### 数据映射规则设计
- Epic frontmatter ↔ Yunxiao WorkItem字段映射
- GitHub Issue格式 ↔ 云效工作项格式转换
- 状态值映射（pending/in_progress/completed ↔ 云效状态）
- 优先级映射（high/medium/low ↔ P0/P1/P2/P3）

## 依赖关系
- **依赖任务001**: 需要配置系统和前置检查机制

## 交付物
- [ ] `.claude/rules/platform-yunxiao-epic-sync.md`规则文件
- [ ] `.claude/rules/platform-yunxiao-issue-sync.md`规则文件
- [ ] `.claude/rules/platform-yunxiao-data-mapping.md`数据映射规则
- [ ] MCP工具调用指令文档
- [ ] 错误处理和故障排除指南
- [ ] 规则文件测试和验证