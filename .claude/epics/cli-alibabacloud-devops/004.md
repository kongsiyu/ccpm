---
name: 创建yunxiao工作项CRUD操作脚本集
status: open
created: 2025-09-30T01:34:16Z
updated: 2025-09-30T01:34:16Z
github: https://github.com/kongsiyu/ccpm/issues/4
depends_on: ["001"]
parallel: true
conflicts_with: []
---

# 任务003：创建yunxiao工作项CRUD操作脚本集

## Description

开发一套完整的脚本，用于对阿里云云效工作项进行CRUD（创建、读取、更新、删除）操作。这些脚本将提供与云效工作项交互的核心能力，支持工作项的生命周期管理，并为后续的同步功能提供基础API封装。

## Acceptance Criteria

1. **工作项创建功能**
   - [ ] 支持创建不同类型的工作项（需求、任务、缺陷等）
   - [ ] 允许设置工作项的基本属性（标题、描述、优先级、指派人等）
   - [ ] 支持模板化创建和批量操作

2. **工作项查询功能**
   - [ ] 按ID、标题、状态、指派人等条件查询工作项
   - [ ] 支持分页和排序
   - [ ] 提供灵活的过滤器组合

3. **工作项更新功能**
   - [ ] 更新工作项的各种属性（状态、描述、指派人等）
   - [ ] 支持批量更新操作
   - [ ] 维护更新历史和审计日志

4. **工作项删除功能**
   - [ ] 安全的工作项删除（带确认机制）
   - [ ] 支持软删除和硬删除
   - [ ] 删除前的依赖关系检查

## Technical Details

### 脚本结构
```bash
.claude/scripts/pm/yunxiao/
├── create-workitem.sh      # 创建工作项
├── get-workitem.sh         # 获取工作项详情
├── list-workitems.sh       # 列出工作项列表
├── update-workitem.sh      # 更新工作项
├── delete-workitem.sh      # 删除工作项
├── workitem-common.sh      # 通用功能库
└── workitem-templates/     # 工作项模板目录
    ├── requirement.json
    ├── task.json
    └── bug.json
```

### 核心功能

#### 创建工作项 (create-workitem.sh)
```bash
create_workitem() {
    local type="$1"
    local title="$2"
    local description="$3"
    local template="$4"

    # 参数验证
    # 模板处理
    # MCP API调用
    # 结果处理和输出
}
```

#### 查询工作项 (get-workitem.sh, list-workitems.sh)
```bash
get_workitem_by_id() {
    local workitem_id="$1"
    # MCP API调用获取详情
}

list_workitems() {
    local filters="$1"
    local page="$2"
    local size="$3"
    # 构建查询条件
    # MCP API调用
    # 格式化输出
}
```

#### 更新工作项 (update-workitem.sh)
```bash
update_workitem() {
    local workitem_id="$1"
    local field="$2"
    local value="$3"
    # 获取当前状态
    # 验证更新权限
    # 执行更新
    # 记录变更日志
}
```

### MCP API集成
- 使用任务001中建立的MCP通信库
- 统一的错误处理和重试机制
- 结果缓存和性能优化

### 数据格式标准化
```json
{
  "workitem": {
    "id": "string",
    "type": "requirement|task|bug",
    "title": "string",
    "description": "string",
    "status": "string",
    "priority": "high|medium|low",
    "assignee": "string",
    "creator": "string",
    "created_time": "ISO8601",
    "updated_time": "ISO8601"
  }
}
```

## Dependencies

### 前置任务
- **任务001**：需要MCP通信库和配置管理功能

### 外部依赖
- 阿里云云效MCP服务器
- jq（JSON处理）

### 内部依赖
- `.claude/lib/yunxiao.sh`（来自任务001）
- `.claude/lib/error.sh`

## Effort Estimate

**3天**

- 第1天：实现基础的CRUD操作（创建和查询）
- 第2天：完善更新和删除功能，添加批量操作支持
- 第3天：优化性能，完善错误处理，编写测试和文档

## Definition of Done

1. **功能完整性**
   - [ ] 所有CRUD操作都正确实现并测试通过
   - [ ] 支持工作项的完整生命周期管理
   - [ ] 批量操作功能稳定可靠

2. **数据一致性**
   - [ ] 所有操作都维护数据的完整性
   - [ ] 并发操作处理正确
   - [ ] 错误回滚机制完善

3. **性能和可靠性**
   - [ ] 查询操作响应时间合理（<2秒）
   - [ ] 批量操作支持进度显示
   - [ ] 网络错误有合适的重试机制

4. **用户体验**
   - [ ] 命令行参数设计直观易用
   - [ ] 输出格式清晰且支持多种格式（表格、JSON）
   - [ ] 错误消息详细且有建设性建议

5. **扩展性**
   - [ ] 脚本设计支持添加新的工作项类型
   - [ ] API封装便于其他功能调用
   - [ ] 模板系统支持自定义工作项模板

6. **文档和测试**
   - [ ] 每个脚本都有详细的使用说明
   - [ ] 提供API文档和示例
   - [ ] 包含自动化测试套件

这些脚本将成为云效集成的核心工具，为项目管理提供强大的工作项操作能力。
