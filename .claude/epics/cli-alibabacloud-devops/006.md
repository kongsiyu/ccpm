---
name: 创建issue-sync-yunxiao工作项同步脚本
status: open
created: 2025-09-30T01:34:16Z
updated: 2025-09-30T01:34:16Z
github: https://github.com/kongsiyu/ccpm/issues/6
depends_on: [003]
parallel: false
conflicts_with: []
---

# 任务005：创建issue-sync-yunxiao工作项同步脚本

## Description

实现云效平台的工作项同步脚本，对应GitHub平台的issue-sync功能。创建完整的issue-sync-yunxiao目录结构，实现工作项的创建、更新、状态同步等核心功能，确保与现有GitHub issue-sync脚本功能完全对等。

## Acceptance Criteria

### 核心功能要求
- [ ] 创建`.claude/scripts/pm/issue-sync-yunxiao/`目录结构
- [ ] 实现工作项同步的所有核心脚本文件
- [ ] 支持工作项状态更新和进度跟踪
- [ ] 实现评论发布和更新机制
- [ ] 提供与GitHub issue-sync完全一致的命令接口

### 脚本文件清单
- [ ] `preflight-validation-yunxiao.sh` - 预检验证脚本
- [ ] `update-frontmatter-yunxiao.sh` - 前置元数据更新
- [ ] `post-comment-yunxiao.sh` - 评论发布脚本
- [ ] `check-sync-timing-yunxiao.sh` - 同步时机检查
- [ ] `calculate-epic-progress-yunxiao.sh` - Epic进度计算

### 技术一致性
- [ ] 所有脚本输入输出格式与GitHub版本完全一致
- [ ] 错误处理机制保持统一标准
- [ ] 日志输出格式符合现有规范
- [ ] 支持相同的命令行参数和选项

## Technical Details

### 目录结构设计
```
.claude/scripts/pm/issue-sync-yunxiao/
├── preflight-validation-yunxiao.sh
├── update-frontmatter-yunxiao.sh
├── post-comment-yunxiao.sh
├── check-sync-timing-yunxiao.sh
├── calculate-epic-progress-yunxiao.sh
└── README.md
```

### 核心实现要点

#### 1. MCP协议集成
- 使用统一的`yunxiao_*`函数进行工作项操作
- 实现错误重试和超时处理机制
- 支持批量操作和状态缓存

#### 2. 状态映射机制
```bash
# GitHub状态 → 云效状态映射
map_status_to_yunxiao() {
    case "$1" in
        "open") echo "新建" ;;
        "in_progress") echo "进行中" ;;
        "closed") echo "已完成" ;;
        "blocked") echo "阻塞" ;;
    esac
}
```

#### 3. 进度计算逻辑
- 基于工作项状态统计Epic完成度
- 支持加权进度计算
- 实时更新Epic状态文件

#### 4. 评论同步策略
- 保持评论格式与GitHub版本一致
- 支持Markdown格式渲染
- 实现评论去重和更新机制

### 依赖关系
- **前置依赖**：任务003（yunxiao工作项CRUD操作脚本）必须完成
- **技术依赖**：MCP协议库和云效API访问权限
- **配置依赖**：`.ccpm-config.yaml`中的project_id配置

## Dependencies

### 直接依赖
- 任务003：yunxiao工作项CRUD操作脚本集
- `.claude/lib/yunxiao.sh`：统一的云效工具库
- `.claude/lib/frontmatter.sh`：前置元数据处理库

### 外部依赖
- 阿里云云效项目访问权限
- MCP服务器正常运行
- Node.js 16+ 运行环境

### 测试依赖
- 云效测试环境配置
- 工作项操作权限验证
- 现有GitHub脚本作为参考基准

## Effort Estimate

**预估工作量：2天**

### 详细分解
- **脚本框架搭建**：0.5天
  - 目录结构创建
  - 基础脚本模板
  - 统一接口设计

- **核心功能实现**：1天
  - MCP协议调用集成
  - 状态映射和转换
  - 前置元数据处理
  - 评论发布机制

- **测试和优化**：0.5天
  - 功能测试和调试
  - 错误处理完善
  - 性能优化
  - 文档完善

### 风险缓冲
- **MCP协议调试**：+0.5天（如遇API限制）
- **状态映射复杂性**：+0.3天（需要精确对应）

## Definition of Done

### 功能完整性
- [ ] 所有issue-sync-yunxiao脚本文件创建完成
- [ ] 工作项同步功能与GitHub版本功能对等
- [ ] 支持完整的工作项生命周期管理
- [ ] 错误处理和日志记录完善

### 质量保证
- [ ] 代码符合项目编码规范
- [ ] 所有脚本通过shellcheck检查
- [ ] 与现有GitHub脚本接口完全一致
- [ ] 单元测试覆盖核心功能

### 集成验证
- [ ] 在测试环境成功创建和更新工作项
- [ ] Epic进度计算准确无误
- [ ] 评论发布功能正常工作
- [ ] 与其他云效脚本正常协作

### 文档交付
- [ ] 脚本功能和使用说明文档
- [ ] 故障排查和调试指南
- [ ] 与GitHub版本的功能对比说明
- [ ] 配置要求和依赖说明

### 验收标准
- [ ] 开发者可以使用云效脚本完成完整的issue同步流程
- [ ] 所有操作的输出格式与GitHub版本保持一致
- [ ] 在网络异常情况下具备合理的降级机制
- [ ] 为后续任务006（命令路由集成）提供可靠的基础
